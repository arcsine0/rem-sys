/*!
 * Start Bootstrap - SB Admin 2 v4.1.3 (https://startbootstrap.com/theme/sb-admin-2)
 * Copyright 2013-2022 Start Bootstrap
 * Licensed under MIT (https://github.com/StartBootstrap/startbootstrap-sb-admin-2/blob/master/LICENSE)
 */

$(document).ready(()=>{var s,r,a=$("#table_data");function t(){$.ajax({url:"http://localhost:4000/users/list",method:"GET",crossDomain:!0,xhrFields:{withCredentials:!1},success:t=>{t&&t.forEach((t,e)=>{t=`
                                        <tr id="row${e}">
                                            <th scope="row">${t.id}</th>
                                            <td class="row-role">${t.role}</td>
                                            <td>${t.email}</td>
                                            <td>${t.password}</td>
                                            <td>${t.fname}</td>
                                            <td>${t.mname}</td>
                                            <td>${t.lname}</td>
                                            <td class="actions">
                                                <button type="button" class="btn btn-warning data-edit" data-toggle="modal" data-target="#editModal">Edit</button>
                                                <button type="button" class="btn btn-danger data-delete">Delete</button>
                                            </td>
                                        </tr>
                                        `;a.append(t)})},error:t=>{console.log(t)}})}function o(){$("#table_data").empty(),t()}function l(t){switch(localStorage.getItem("role")){case"admin":return"admin"==t||"staff"==t||"member"==t||"null"==t;case"staff":return"staff"==t||"member"==t;case"member":default:return"admin"!=t&&"staff"!=t}}t(),$("#staff_table").on("click",".data-edit",t=>{var e=$(t.target.closest("tr")).children("td"),a=$(t.target.closest("tr")).find("th");r=$(t.target.closest("tr")).find(".row-role").html();var o=[];e.each((t,e)=>{"actions"!=$(e).attr("class")&&o.push(e.innerHTML)}),$("#edit-form").children("div").each((t,e)=>{e=$(e).find("input");null!=e.attr("placeholder")&&(e.attr("placeholder",o[t]),e.val(o[t]))}),s=a.html()}),$("#save-edit").on("click",()=>{var t=$("#edit-form").serializeArray();t.push({name:"id",value:s}),!1===l(r)?(console.log("You do not have permission to edit"),$("#errorModal").modal("show")):$.ajax({url:"http://localhost:4000/users/edit",type:"POST",data:t,crossDomain:!0,xhrFields:{withCredentials:!1},success:t=>{t&&"success"==t&&(console.log("saved"),o())},error:t=>{console.log(t)}})}),$("#staff_table").on("click",".data-delete",t=>{var e=$(t.target.closest("tr")).find("th");!1===l($(t.target.closest("tr")).find(".row-role").html())?(console.log("You do not have permission to delete"),$("#errorModal").modal("show")):$.ajax({url:"http://localhost:4000/users/edit",type:"DELETE",data:{name:"id",value:e.html()},crossDomain:!0,xhrFields:{withCredentials:!1},success:t=>{t&&"success"==t&&(console.log("saved"),o())},error:t=>{console.log(t)}})}),$("#add-row").on("click",t=>{var e=$(".table_add form").serializeArray();!1===l($("#role_select").val())?$("#errorModal").modal("show"):$.ajax({url:"http://localhost:4000/users/add",type:"POST",data:e,crossDomain:!0,xhrFields:{withCredentials:!1},success:t=>{t&&"success"==t&&(console.log("saved"),o())},error:t=>{console.log(t)}})})});